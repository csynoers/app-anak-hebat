<template>
<div class="page" data-name="carts-page">
  <div class="navbar">
    <div class="navbar-bg"></div>
    <div class="navbar-inner sliding">
      <!-- <div class="left">
        <a href="#" class="link back">
          <i class="icon icon-back"></i>
          <span class="if-not-md">Back</span>
        </a>
      </div> -->
      <div class="title">Keranjang Belanja</div>
    </div>
  </div>
  <div class="page-content">
    <div class="block-title">Keranjang Belanja Kosong</div>
    <div class="card">
      <div class="card-content">
        <div class="list media-list">
          <ul>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
</template>
<script>
  export default {
    // Lifecycle Hooks
    mounted() {
      console.log('# CART PAGE --------------------------------------------------------------------');

      // this tab show
      this.$$('#view-keranjang').on('tab:show',function(){
        console.log('# CART SHOW',this)
      })

      let $$ = this.$$;
      let route = this.$route;
      let app = this.$app;
      let page = $$('.page[data-name=carts-page]');
      let pageContent = page.find('.page-content');
      let pageContentBlockTitle = page.find('.block-title');
      let pageContentUl = pageContent.find('ul');

      if ( route.hash ) {
        if ( route.hash == 'from-book-details' ) {
          console.log('CART FROM DETAIL')
          
          // if .toolbar-main has class tab link remove first before update link tab active
          if ( $$('.toolbar-main .tab-link').hasClass('tab-link-active') ) {
            // remove class
            $$('.toolbar-main .tab-link').removeClass('tab-link-active');

            // set new tab active
            $$('.toolbar-main .tab-link').forEach(function(a,b){
              if ( $$(a).attr('href') == '#view-keranjang' ) {
                $$(a).addClass('tab-link-active');
                $$('.toolbar-main .tab-link-highlight').css({
                  "width": "20%",
                  "transform": "translate3d(200%, 0px, 0px)"
                });

                // remove class #view home
                $$('#view-home').removeClass('tab-active');
                // add class #view-keranjang
                $$('#view-keranjang').addClass('tab-active');
              }
            })
          }
        }
      }

      app.localforage.getItem('carts').then(function(value) {
          // This code runs once the value has been loaded
          // from the offline store.
          // console.log(value);
          if ( value.rowsData ) {
            value.rowsData.forEach(function(a,b){
              app.request.getJSON(`https://m.anakhebatindonesia.com/books/${a.id}`, function (data) {
                pageContentUl.append(`
                  <li class="item-content">
                    <div class="item-media"><img src="${data.data.image.thumbnail}" width="44"/></div>
                    <div class="item-inner">
                      <div class="item-title-row">
                        <div class="item-title">${data.data.title}</div>
                      </div>
                      <div class="text-currency-primary"><span class="text-currency-format">Rp</span>${data.data.price.idr.text}</div>
                      <div class="stepper stepper-small stepper-init">
                        <div class="stepper-button-minus"></div>
                        <div class="stepper-input-wrap">
                          <input type="text" value="${a.qty}" min="0" max="100" step="1" readonly>
                        </div>
                        <div class="stepper-button-plus"></div>
                      </div>
                    </div>
                  </li>              
                `);
                // console.log(data.data)
              })
            });
            
            pageContentBlockTitle.css({"display":"none"});
          } else {
            
          }
      }).catch(function(err) {
          // This code runs if there were any errors
          console.log(err);
      });
      // app.request.getJSON(`https://m.anakhebatindonesia.com/books/${bookId}`, function (data) {
    },
    // Component Methods
    methods: {
      toolbarBottomShow: function() {
        let $$ = this.$$;
        $$('.toolbar-main').show();
      },
    },
    // Page Events
    on: {
      pageMounted: function(e, page) {
        this.toolbarBottomShow();
        // console.log(page)
      },
      pageBeforeIn: function(e, page) {
        // console.log(page)
      },
    }
  }
</script>