<template>
<div class="page" data-name="carts-page">
  <div class="navbar">
    <div class="navbar-bg"></div>
    <div class="navbar-inner sliding">
      <div class="left">
        <a href="#" class="link back">
          <i class="icon icon-back"></i>
          <span class="if-not-md">Back</span>
        </a>
      </div>
      <div class="title">Keranjang Belanja</div>
    </div>
  </div>
  <div class="toolbar toolbar-bottom" style="height: calc(var(--f7-toolbar-height) *2);">
    <div class="toolbar-inner">
      <div class="block" style="width: 100vw">
        <div class="list no-hairlines">
          <ul>
            <li>
              <div class="item-content">
                <div class="item-inner">
                  <div class="item-title" style="white-space: unset;">Tukarkan <span id="pointRewardCheckout">0</span> Point Reward</div>
                  <div class="item-after">
                    <span class="margin-right" id="pointRewardCheckoutConvert">[-Rp0]</span>
                    <label class="toggle" id="toggleCheckout">
                      <input type="checkbox"/>
                      <span class="toggle-icon"></span>
                    </label>
                  </div>
                </div>
              </div>
            </li>
            <li>
              <div class="item-content">
                <div class="item-inner">
                  <div class="item-after">
                    <span class="text-color-black" style="padding-top: 6px;">SubTotal: </span>
                    <span class="margin-left-half margin-right text-currency-primary" style="font-weight: bold; padding-top: 6px;">Rp0</span>
                    <button type="button" class="button button-fill">Checkout</button>
                  </div>
                </div>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="page-content">
    <div class="block-title">Keranjang Belanja Kosong</div>
    <div class="card">
      <div class="card-content">
        <div class="list media-list">
          <ul>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
</template>
<script>
  export default {
    // Lifecycle Hooks
    mounted() {
      console.log('# CART PAGE --------------------------------------------------------------------');
      const self = this;
      
      let $$ = this.$$;
      let route = this.$route;
      let app = this.$app;
      let page = $$('.page[data-name=carts-page]');
      let pageContent = page.find('.page-content');
      let pageContentBlockTitle = page.find('.block-title');
      let pageContentUl = pageContent.find('ul');

      app.localforage.getItem('carts').then(function(value) {
          // This code runs once the value has been loaded
          // from the offline store.
          // console.log(value);
          if ( value ) {
            value.rowsData.forEach(function(a,b){
              pageContentUl.html('');
              app.request.getJSON(`https://m.anakhebatindonesia.com/books/${a.id}`, function (data) {
                pageContentUl.append(`
                  <li class="item-content">
                    <div class="item-media"><img src="${data.data.image.thumbnail}" width="44"/></div>
                    <div class="item-inner">
                      <div class="item-title-row">
                        <div class="item-title">${data.data.title}</div>
                      </div>
                      <div class="text-currency-primary"><span class="text-currency-format">Rp</span>${data.data.price.idr.text}</div>
                      <div class="stepper stepper-small stepper-init">
                        <div class="stepper-button-minus"></div>
                        <div class="stepper-input-wrap">
                          <input type="text" value="${a.qty}" min="0" max="100" step="1" readonly>
                        </div>
                        <div class="stepper-button-plus"></div>
                      </div>
                    </div>
                  </li>              
                `);
                // console.log(data.data)
              })
            });
            
            pageContentBlockTitle.css({"display":"none"});
          } else {
            
          }
      }).catch(function(err) {
          // This code runs if there were any errors
          console.log(err);
      });
      // app.request.getJSON(`https://m.anakhebatindonesia.com/books/${bookId}`, function (data) {

      // set point reward
      self.$app.localforage.getItem('users').then(function(value) {
        // This code runs once the value has been loaded
        // from the offline store.
        // console.log(value);
        if ( value ) {
          self.$$('#pointRewardCheckout').attr("data-point-reward", value.point_member);
          self.$$('#pointRewardCheckout').text( self.formatRupiah(value.point_member) );
        }
      }).catch(function(err) {
        // This code runs if there were any errors
        console.log(err);
      });

      // event toggle point reward
      self.$app.toggle.create({
        el: '#toggleCheckout',
        on: {
          change: function () {
            console.log(this)
            if ( this.checked ) {
              self.$$('#pointRewardCheckoutConvert').css("color","#ee4d2d");
            } else {
              self.$$('#pointRewardCheckoutConvert').css("color","unset");
            }
          }
        }
      })
    },
    // Component Methods
    methods: {
      toolbarBottomHide: function() {
        let $$ = this.$$;
        $$('.toolbar-main').hide();
      },
      formatRupiah: function(angka){
        var	number_string = angka.toString(),
        sisa 	= number_string.length % 3,
        rupiah 	= number_string.substr(0, sisa),
        ribuan 	= number_string.substr(sisa).match(/\d{3}/g);
          
        if (ribuan) {
          let separator = sisa ? '.' : '';
          rupiah += separator + ribuan.join('.');
        }

        return rupiah; // Hasil: 23.456.789
      }
    },
    // Page Events
    on: {
      pageMounted: function(e, page) {
        this.toolbarBottomHide();
        // console.log(page)
      },
      pageBeforeIn: function(e, page) {
        // console.log(page)
      },
    }
  }
</script>