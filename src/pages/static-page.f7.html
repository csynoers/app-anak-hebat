<template>
  <div class="page" data-name="static-page">
    <div class="navbar">
      <div class="navbar-bg"></div>
      <div class="navbar-inner sliding">
        <div class="left">
          <a href="#" class="link back">
            <i class="icon icon-back"></i>
            <span class="if-not-md">Back</span>
          </a>
        </div>
        <div class="title">{{this.$route.hash}}</div>
        <div class="right">
          <a href="/keranjang/" class="link icon-only">
            <i class="icon f7-icons">cart<span class="badge color-red cart-label"  >0</span></i>
          </a>
        </div>
      </div>
    </div>   
    <div class="page-content"></div>
  </div>
</template>
<style>
  /* p {
    margin: 10px 0;
  } */
</style>
<script>
  export default {
    // Lifecycle Hooks
    mounted() {
      console.log('# STATIC PAGE ------------------------------------------------------------------');

      let $$ = this.$$;
      let app = this.$app;
      let router = this.$router;
      let pageName = this.$route.params.pageName;
      let page = $$('.page[data-name="static-page"]');
      let pageContent = page.find('.page-content')

      /* jika ini halaman join reseller sembunyikan tombol kembali */
      // if ( pageName == 'join-reseller' ) {
      //   page.find('.back').hide()
      // } else {
        /* jika halaman ini bukan join reseller sembunyikan toolbar utama */
        $$('.toolbar-main').hide()
      // }

      /* cart label */
      let cartLabel = $$('.cart-label');
      app.localforage.getItem('carts').then(function(value) {
          // This code runs once the value has been loaded
          // from the offline store.
          if ( value.rowsData ) {
            let cartRows = value.rowsData.length;
            cartLabel.text(cartRows);
            cartLabel.css({"display" : "inline-flex"});
          }
          
          // console.log();
      }).catch(function(err) {
          // This code runs if there were any errors
          console.log(err);
      });

      app.preloader.show();
      console.log( pageName )
      switch ( pageName ) {
        case 'faq':
          /* get detail buku */
          app.request.getJSON(`https://m.anakhebatindonesia.com/faqs`, function (data) {
            let rowsAccordion = [];
            data.forEach(function(d){
              rowsAccordion.push(`
                <li class="accordion-item"><a href="#" class="item-content item-link">
                    <div class="item-inner">
                      <div class="item-title">${d.q}</div>
                    </div></a>
                  <div class="accordion-item-content">
                    <div class="block">
                      <p>${d.a}</p>
                    </div>
                  </div>
                </li>
              `);
            });
            rowsAccordion.join('');
            pageContent.html(`
              <!-- Separate collapsibles - omit "accordion-list" class-->
              <div class="block">FAQ (Frequently asked questions) apakah anda ingin mengetahui sesuatu mengenai kami?</div>
              <div class="list">
                <ul>
                  ${rowsAccordion}
                </ul>
              </div>       
            `);
          });
          
          break;

        case 'join-reseller':
          /* get detail buku */
          app.request.getJSON(`https://m.anakhebatindonesia.com/profil/1`, function (data) {
            pageContent.html(`
              <div class="toolbar tabbar toolbar-top" style="position:fixed">
                <div class="toolbar-inner">
                  <a href="#tab-1" class="tab-link tab-link-active">Indonesia</a>
                  <a href="#tab-2" class="tab-link">English</a>
                </div>
              </div>
              <div class="tabs" style="margin: -5em 0em -5em 0em !important;">
                <div id="tab-1" class="page-content tab tab-active">
                  <div class="block text-align-justify">
                    <p>${data.data.content.in}</p>
                  </div>
                </div>
                <div id="tab-2" class="page-content tab">
                  <div class="block text-align-justify">
                    <p>${data.data.content.us}</p>
                  </div>
                </div>
              </div>       
            `);
          });
          
          break;

        case 'bantuan':
          app.request.getJSON(`https://m.anakhebatindonesia.com/contact`, function (data) {
            pageContent.html(`
              <div class="block text-align-justify">
                <h3>
                  Apakah ada yang ingin anda tanyakan mengenai kami? atau apakah dan menemui permasalahan dalam bebelanja?
                </h3>
                Jangan ragu untuk menghubungi kami, melalui kontak di bawah ini :
              </div>
              <div class="card">
                <div class="card-header">Alamat <i class="icon f7-icons">placemark</i></div>
                <div class="card-content card-content-padding">${data.data.content_1}</div>
              </div>
              <div class="card">
                <div class="card-header">Nomor kontak <i class="icon f7-icons">phone_circle</i></div>
                <div class="card-content card-content-padding">${data.data.content_2}</div>
              </div>
              <div class="card">
                <div class="card-header">E-mail <i class="icon f7-icons">envelope</i></div>
                <div class="card-content card-content-padding">${data.data.content_3}</div>
              </div>
            `);
          });
          
          break;
          
          case 'cek-resi':
            pageContent.html(`
              <div class="list inset">
                <ul>
                  <li class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-input-wrap">
                        <input type="text" placeholder="Masukan nomor resi pengiriman">
                        <span class="input-clear-button"></span>
                      </div>
                    </div>
                  </li>
                  <li class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-title item-label">Kurir</div>
                      <div class="item-input-wrap input-dropdown-wrap">
                        <select>
                          <option value="Male">JNE</option>
                          <option value="Female">TIKI</option>
                          <option value="Female">POS</option>
                        </select>
                      </div>
                    </div>
                  </li>                  
                  <li class="item-content">
                    <button type="submit" class="col button button-fill">Lacak Paket</button>
                  </li>
                </ul>
              </div>            
            `);
            break;
          case 'cek-ongkir':
            pageContent.html(`
              <div class="toolbar tabbar toolbar-top" style="position:fixed">
                <div class="toolbar-inner">
                  <a href="#tab-1-reward" class="tab-link tab-link-active">Domestik</a>
                  <a href="#tab-2-reward" class="tab-link">Internasional</a>
                </div>
              </div>
              <div class="tabs" style="margin: -5em 0em -5em 0em !important;">
                <div id="tab-1-reward" class="page-content tab tab-active">
                  <div class="block">
                    <div class="list inset">
                    <form action="javascript:void(0)" id="formCekOngkir">
                      <ul>
                        <li class="item-content item-input">
                          <div class="item-inner">
                            <div class="item-input-wrap">
                              <input name="city" id="autocomplete-dropdown-expand" type="text" placeholder="Kota tujuan pengiriman" required autocomplete="off">
                            </div>
                          </div>
                        </li>
                        <li class="item-content item-input">
                          <div class="item-inner">
                            <div class="item-input-wrap">
                              <input name="subdistrict" id="autocomplete-dropdown-expand-subdistrict" type="text" placeholder="Kecamatan tujuan pengiriman" required autocomplete="off">
                            </div>
                          </div>
                        </li>
                        <li class="item-content item-input">
                          <div class="item-inner">
                            <div class="item-title item-label">Berat (Gram)</div>
                            <div class="item-input-wrap">
                              <input name="weight" id="inputWeight" type="number" placeholder="Berat kiriman" value="1000" required>
                            </div>
                          </div>
                        </li>                  
                        <li class="item-content">
                          <input name="city_id" id="cityId" type="hidden">
                          <button type="submit" class="col button button-fill">Periksa Ongkir</button>
                        </li>
                      </ul>
                    </form>
                    </div> 
                  </div>
                </div>
                <div id="tab-2-reward" class="page-content tab">
                  <div class="block text-align-justify">
                    <p>informasi point reward</p>
                  </div>
                </div>
              </div>
              <div id="listCouriers" class="block"></div>
              <div class="row text-align-center">
                <div class="col-100">
                  <div class="preloader" style="display:none"></div>
                </div>
              </div>             
            `);
            
            $$( "#formCekOngkir #autocomplete-dropdown-expand-subdistrict" ).prop( "disabled", true );

            var autocompleteDropdownExpand = app.autocomplete.create({
              inputEl: '#autocomplete-dropdown-expand',
              openIn: 'dropdown',
              valueProperty: 'city_name', //object's "value" property name
              textProperty: 'city_name', //object's "text" property name
              source: function (query, render) {
                var results = [];
                if (query.length < 3) {
                  render(results);
                  return;
                }

                app.request({
                  url: 'static/cities.json',
                  method: 'GET',
                  dataType: 'json',
                  //send "query" to server. Useful in case you generate response dynamically
                  data: {
                    query: query
                  },
                  success: function (data) {
                    // console.log(data)
                    // Find matched items
                    for (var i = 0; i < data.length; i++) {
                      // console.log(data[i].city_name.toLowerCase())
                      if (data[i].city_name.toLowerCase().indexOf(query.toLowerCase()) >= 0)
                        results.push(data[i]);
                    }
                    // console.log(results)
                    // Render items by passing array with result items
                    render(results);
                  }
                });
              },
              on: {
                change: function (value) {
                  $$('#formCekOngkir').find('#cityId').val(value[0].city_id);
                  $$( "#formCekOngkir #autocomplete-dropdown-expand-subdistrict" ).prop( "disabled", false );
                }
              }
            });

            var autocompleteDropdownExpandKecamatan = app.autocomplete.create({
              inputEl: '#formCekOngkir #autocomplete-dropdown-expand-subdistrict',
              openIn: 'dropdown',
              valueProperty: 'subdistrict_name', //object's "value" property name
              textProperty: 'subdistrict_name', //object's "text" property name
              source: function (query, render) {
                var results = [];
                if (query.length < 3) {
                  render(results);
                  return;
                }
                let city = $$('#formCekOngkir').find('#cityId').val();

                app.request({
                  url: 'http://m.anakhebatindonesia.com/ongkir/subdistrict',
                  method: 'GET',
                  dataType: 'json',
                  //send "query" to server. Useful in case you generate response dynamically
                  data: {
                    city: city
                  },
                  success: function (data) {
                    data = data.rajaongkir.results;

                    // Find matched items
                    for (var i = 0; i < data.length; i++) {
                      // console.log(data[i].city_name.toLowerCase())
                      if (data[i].subdistrict_name.toLowerCase().indexOf(query.toLowerCase()) >= 0)
                        results.push(data[i]);
                    }
                    // console.log(results)
                    // Render items by passing array with result items
                    render(results);
                  }
                });
              },
              on: {
                change: function (value) {
                  console.log(value)
                  // $$('#formCekOngkir').find('#cityId').val(value[0].city_id);
                }
              }
            });

            $$('#formCekOngkir').on('submit',function(e){
              let getInput = {
                "city" : document.getElementById("autocomplete-dropdown-expand").value,
                "weight" : document.getElementById("inputWeight").value,
              };
              app.request({
                url: 'static/cities.json',
                method: 'GET',
                dataType: 'json',
                //send "query" to server. Useful in case you generate response dynamically
                // data: {
                //   query: getInput
                // },
                success: function (data) {
                  let results = [];
                  // console.log(data)
                  // Find matched items
                  for (var i = 0; i < data.length; i++) {
                    // console.log(data[i].city_name.toLowerCase())
                    if (data[i].city_name.toLowerCase().indexOf(getInput.city.toLowerCase()) >= 0) results.push(data[i]);
                  }

                  pageContent.find('#listCouriers').html('');
                  results.forEach(function(item,index) {
                    app.preloader.show();
                    app.request.getJSON(`https://m.anakhebatindonesia.com/ongkir/cost-all?destination=${item.city_id}&weight=${getInput.weight}`, function (cost) {
                      let listCouriersByCity = [];
                      cost.forEach(function(itemCost,indexCost){
                        let title = `${itemCost.code} ${itemCost.service} (${itemCost.etd}) - IDR ${itemCost.value}`;
                        listCouriersByCity.push(`<tr><td class="label-cell">${title}</td></tr>`);
                      })
                      listCouriersByCity = listCouriersByCity.join('');
                      let listCouriersByCityHTML = `
                      <div class="data-table">
                        <table>
                          <thead>
                            <tr>
                              <th class="label-cell">Hasil pengecekan ke <b class="padding-horizontal-half">${item.city_name}</b> @ <b class="padding-horizontal-half">${getInput.weight}</b> Gram</th>
                            </tr>
                          </thead>
                          <tbody>
                            ${listCouriersByCity}
                          </tbody>
                        </table>
                      </div>`;
                      pageContent.find('#listCouriers').append(listCouriersByCityHTML);
                      app.preloader.hide();
                    })
                  })
                }
              });

            });

            break;
          case 'penawaran-khusus':
          // app.preloader.show();
          pageContent.html(`<div class="row no-gap"></div>`);
      /* Ajax Request */
      app.request.getJSON(`https://m.anakhebatindonesia.com/books`, { limit : 10 }, function (json) {
        json.rows.forEach(function(d){
          pageContent.find('.row').append(`
            <div class="col-50 book" data-href="/book/${d.id}">
              <div class="card card-outline">
                <div class="card-content">
                  <img data-src="${d.image.thumbnail}" class="lazy lazy-fade-in" alt="" width="100%">
                  <center>
                    <div class="book-title-wrap">
                      ${d.title}
                    </div>
                    <div class="text-currency-primary">
                      <span class="text-currency-format">Rp</span>${d.price.idr.text}
                    </div>
                  </center>
                </div>
              </div>
            </div>          
          `);
          app.lazy.create(pageContent.find('.lazy'));
          // event to load detail buku;
          pageContent.find('.book').on('click',function(e){
            let dataHref = $$(this).data('href');
            router.navigate(dataHref,{ transition: 'f7-fade' })
          })
        });
      });
      // app.preloader.hide();
            break;
      
        default:
          break;
      }
      app.preloader.hide();
      
    },
    destroyed() {
      let $$ = this.$$;
      /* jika halaman ini bukan join reseller ketika meninggalkan halaman ini tampilkan kembali toolbar utama */
      // if (this.$route.params.pageName != 'join-reseller')
        // $$('.toolbar-main').show()
    },
    // Component Data
    data: function () {
      // Must return an object
      return {
        name: 'Jimmy',
        age: 25,
        like: ['Tennis', 'Chess', 'Football'],
      }
    },
    // Component Methods
    methods: {
      openAlert: function (data) {
        var self = this;
        self.$app.dialog.alert(data);
      },
      getDateDMY: function(dateValue) {
        var mydate = new Date(dateValue);
        var month = ["January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"][mydate.getMonth()];
        var str = mydate.getDay() + ' ' +	month + ' ' + mydate.getFullYear();
        return str;
      }
    },
  }
</script>
